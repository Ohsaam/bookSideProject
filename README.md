# 도서관리시스템
> **1차 개발기간 : 2023.11.4 ~ 2023.11.14




<img src="https://github.com/Ohsaam/bookSideProject/assets/96507825/0bd3b5e5-ef73-43f5-becd-7cb213411a19" width="500"/>


<a href="https://hits.seeyoufarm.com"><img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fgithub.com%2FOhsaam%2FChatJava&count_bg=%23697361&title_bg=%23555555&icon=&icon_color=%23816C6C&title=visit&edge_flat=false"/></a>

---

</div>


## 프로젝트 소개 : 
- #### 도서관리프로그램 구현 

## 화면 구성 📺

### 로그인

| 로그인  |  회원가입   | 
| :-------------------------------------------: | :-------------------------------------------: |
|  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/cbe2d074-7f3b-473c-8a31-8a81738f85eb"/> |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/91871387-69fe-43e5-9c93-bc2e3a72727c"/>
| 로그인 - (아이디/비밀번호검사)  |  회원가입- 파이어베이스연동 |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/e731bab1-bbdf-421b-8101-083c9c83b734">  |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/1d3c38a3-9755-4a8f-9d0d-201b3a1bbc2c">    |
| 로그인 - 성공  |  회원가입- 유효성검사  |  
|  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/764d5416-ff58-496d-b951-d2d18dd76401">                | <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/b83fed71-817c-4c8f-afbc-989f2877b8e6">   |
| 소셜-카카오로그인  |  소셜-구글로그인  |  
|  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/1ea8c7f3-08fb-48a1-85ec-aedd55458920">                | <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/9dbe9cbd-2704-4b49-bb84-c1b491940ed0">   |

### 검색

| 검색  |  책 내용-가격 및 할인가  |
| :-------------------------------------------: | :------------: |
|  <img width="400" src=https://github.com/Ohsaam/bookSideProject/assets/96507825/d3f969bf-2b65-407f-b34c-cdff03737ce4/> |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/fabe7a5e-ecda-4a72-bc91-e408d2144c19"/>|  
| 페이지네이션   |  포스트맨 사용   |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/8a3ea9d2-4b75-480f-b807-770bd839ad3b"/>   |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/15d3e7fa-a068-4008-9bc7-67c4df57b4f4"/>     |


### 게시판


| 게시판-list  |  게시판-글쓰기  |
| :-------------------------------------------: | :------------: |
|  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/01ad6754-6144-4fb7-bd10-77b4337bed25"/> |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/0dfdd9c1-474b-4d1e-a324-4588d9520b98"/>|  
| 게시판 - 글쓰기(완료)  |  게시판 - 글쓰기(취소)   |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/01689e7e-54a8-4026-9c47-58d7d1fcd709"/>   |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/3e0405ff-027e-4081-a5fe-d1d22fbadd3c"/>     |
| 게시판 - 상세보기  |  게시판 - 수정   |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/66e0f4ec-a128-4357-b882-3c36010060c5"/>   |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/2d6b716b-47b6-4224-ac0f-b2c4c7bbd433"/>     |
| 게시판 - 수정 후 반영 |  게시판 - 수정 후 목록   |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/bc67b188-3195-4a32-b201-de99e3c6f44f"/>   |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/8f55ad36-bc58-423e-ae60-9b0f9057e811"/>     |
| 게시판 - 삭제 |  게시판 - 삭제 후 목록   |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/ceab51fe-f10e-46da-80e9-891285b99b15"/>   |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/bd50bdee-2e5b-40b0-b3ef-4c0a18a132df"/>     |
| 게시판 - 조회수[list목록-상세조회]+ 새로고침 방어 |  게시판 - 조회수[list목록-상세조회]  + 새로고침 방어 |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/5305c1b1-cfce-4c67-83ae-165e4a44847f"/>   |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/cfd5af0c-f488-49fd-93e2-e6e32ace1968"/>     |
| 게시판 - 조회수[url접근-list목록]+ 새로고침 방어 |  게시판 - 조회수[url접근-list목록] + 새로고침 방어 |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/3c0e014b-8ff4-464a-8ecc-b3f0080207f0"/>   |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/5373a16e-1155-47ab-85c5-41ebe100d118"/>     |
| 게시판 - 페이징처리1 |  게시판 - 페이징처리2   |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/c72e7216-f691-44a9-8479-e2d3b9156cde"/>   |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/57326c3a-02b9-4369-a1a9-2daa6c12a169"/>     |


## 주요 기능 



### ⭐️ 로그인
- 회원가입, 로그인,로그아웃 2개의 기능 구현
- 로그인 시 로컬스토리지 및 구글파이어베이스(인증)에 저장 되어 있는 ID/Paswword 가져와서 정보가 맞으면 로그인 성공, 틀리면 로그인 실패
- RESTful API을 이용하여 카카오 및 구글 소셜로그인 구현, nickname(카카오), email(구글) 가져와서 로컬스토리지에 저장 -> (게시판 작성 시 필요)

### ⭐️ 회원가입
- 모든 필드을 충족 후 회원가입 가능 구현(유효성 검사)
- 회원가입 시 ID/Password/Nickname 로컬스토리지 및 구글파이어베이스(인증)에 저장.

### ⭐️ 책검색
- RESTful API 카카오(도서)를 이용하고, Postman을 통해서 {Key : Value} 값 매핑 
- 책이름을 입력하고/Enter 누르면 사용자에게 가격, 할인가격, 책 상태(판매,절판) 제공
- 할인가(빨간색), 책 상태(초록색)으로 제공
- 페이지 당 책 내용 20개씩 제공

### ⭐️ 게시판

- 글쓰기(Create),읽기(Read),수정(Update),삭제(Delete) CRUD 구현
- 로컬스토리지를 이용하여 상태 값 관리 (세션 및 쿠키 이용 X)
- index 쿼리스트링으로 페이지 값 부여 및 객체 관리
- 게시판 게시글 3개로 제한 및 페이지네이션 구현

## 시작 가이드

### Requirements

- NodeJS
- npm install express-generator -g 
### Installation
``` bash
$ git clone https://github.com/Ohsaam/bookSideProject.git
$ cd bookSideProject
```


## Stacks 🐈

### Environment
 
- ![Visual Studio Code](https://img.shields.io/badge/Visual%20Studio%20Code-007ACC?style=for-the-badge&logo=Visual%20Studio%20Code&logoColor=white)
- ![Git](https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=Git&logoColor=white)
- ![Github](https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=GitHub&logoColor=white)             


### Development
- <img src="https://img.shields.io/badge/HTML-F80000?style=for-the-badge&logo=HTML&logoColor=white">
- <img src="https://img.shields.io/badge/Javascript-782A90?style=for-the-badge&logo=Javascript&logoColor=white">
- <img src="https://img.shields.io/badge/ejs-3232FF?style=for-the-badge&logo=ejs&logoColor=white">


## 아키텍쳐
```
bookSideProject
├─ .vscode
│  └─ settings.json
├─ app.js
├─ bin
│  └─ www
├─ package-lock.json
├─ package.json
├─ public
│  ├─ images
│  │  ├─ header01.png
│  │  ├─ header02.png
│  │  ├─ header03.png
│  │  ├─ header04.png
│  │  └─ loading.gif
│  ├─ javascripts
│  │  ├─ authLogic.js
│  │  ├─ board.js
│  │  └─ firebase.js
│  └─ stylesheets
│     └─ style.css
├─ routes
│  ├─ index.js
│  └─ users.js
└─ views
   ├─ auth
   │  ├─ join.ejs
   │  └─ login.ejs
   ├─ board
   │  ├─ board.ejs
   │  ├─ modify.ejs
   │  ├─ read.ejs
   │  └─ write.ejs
   ├─ book
   │  └─ bookList.ejs
   ├─ error.ejs
   ├─ footer.ejs
   ├─ header.ejs
   ├─ home.ejs
   ├─ index.ejs
   └─ users
      ├─ cart.ejs
      └─ mypage.ejs

```
---

# 이슈관리 & 회고

<img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/8e163d8b-51f7-4a77-8114-a830af13c5f0"/>
<img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/c895c482-4338-48d2-b016-9cf48ec00921"/>

 우선 제일 아쉬운 부분이 기존에 진행했던 깃헙 레포지토리를 private로 바꿨다. 그 이유는 내 API Key를 노출 시켰기 때문이다. 참.. 처음에 env. 파일 설정을 하고 API키를 부여하는지 프로젝트가 마무리 될 쯤 알게됐다. 회사였으면 정말 큰일 날 뻔 했다. 이렇게 또 하나 배웠다. 보안상 이슈가 제일 중요한 부분인데 이 부분을 신경쓰지 못했다니.. 정말 쪽팔리고 부끄럽다 


 ## 회원가입 시 렌더링 에러 


![image](https://github.com/Ohsaam/bookSideProject/assets/96507825/33d5a6b1-f371-4124-b24c-b86eb2e56ea2)

회원가입 시 해당 타이틀이 계속 보인다.

이 말은 지금 토글 처리를 해야된다. --> 아니면 페이지 구성 요소를 바꿔야 하는가?

나는 회원가입에 들어가면 게시판 부분이 안 보이게 수정하고 싶다.
내가 생각한 아이디어는 토글의 원리다. 켜져있으면 끄자. 근데 그건 하나의 태그만 가능 한 것 아닌가?

로그인 시 --> 해당 부분들이 보이게 구현해보자.

어차피 email을 갖고 있지 않을테니 해당 부분을 활용해 회원가입 페이지 이동 시
bookList가 노출되지 않도록 수정해보자.

```
if(localStorage.getItem('email')) //localStorage에 getItem('item')을 갖고 있다면, == 사용자가 이메일을 입력 했을 때, 
{
  $('#login, #logout, #mypage, #cart').toggle(); // 토글 버튼을 활성화 시킨다.
}
```


이런식으로는 구현이 안 될까? --> Nope

인덱스.ejs도 수정 했는데 잘 안된다.. 뭐가 문제인거지? CSS와는 방향성이 맞지 않음 만약에 컨트롤 한다면 index.html같은데 뭐가 잘못된거지 ?


전체 flow chart 재분석 후 --> index.html의 렌더링 문제로 routers 경로를 바꿨음

![image](https://github.com/Ohsaam/bookSideProject/assets/96507825/32a654ae-4289-4ff3-b722-67681be695e0)


```
<div class="row my-5">
  <div class="col">
    <%-include("book/bookList.ejs")%>
<%-include("auth/join.ejs")%>
  </div>
</div>
```
처음엔 으로 구현 되어 있었는데
```
<div class="row my-5">
  <div class="col">
    <%-include("book/bookList.ejs")%>
  </div>
</div>
```

으로 수정 해결완료

---

## 로그인 시 404 에러

처음 방향성
form 객체에 대한 이슈가 아닐까?

: form객체에 대한 method 소통 방식을 post가 아닌 get으로 구동 시 404 에러가 발생하지 않는다.

하지만 get방식은 보안이슈로 인해 가급적 사용하지 않는 것이 좋다.. 하필이면 로그인 창에서 get 방식은 최악이다.

![image](https://github.com/Ohsaam/bookSideProject/assets/96507825/c314a55d-123a-4a3a-9273-ec7f27824aed)



라우터 경로 확인 --> 이상 무
app.js 경로 확인 --> 이상 무
form 전송 방식에 이슈가 있는 것으로 추정 --> 태그를 바꿔보자. (get) 전송 방식은 구현이 되지만 404 가 뜨진 않지만 회원 페이지가 넘어가지 않는다. form 페이지를 계속 써야 되는 것인가?



로컬스토러지는 사용자가 회원가입해서 잘 갖고 있는 상태로 로그인창으로 리다이렉션한다. 개발자도구에서도 확인 했지만 문제 없었다. --> 구글 파이어베이스에도 잘 저장 되어 있는 것을 알 수 있다. 뭐가 문제인거지?


![image](https://github.com/Ohsaam/bookSideProject/assets/96507825/8a300405-a2aa-4524-b537-33e5bca161d7)




[원인]: firebase 연동 오류로 값을 읽어들이지 못하는 문제가 발생했던 것

[해결] 프로젝트 새로 만들어서 토큰 값 받고 다시 구현 --> 로그인 시 404 안 뜸


![image](https://github.com/Ohsaam/bookSideProject/assets/96507825/6b046cd2-9689-44e1-a92b-9af64c3bfc7d)

![image](https://github.com/Ohsaam/bookSideProject/assets/96507825/2963f5e0-4834-47fc-bc66-979e9a7c6ea4)


![image](https://github.com/Ohsaam/bookSideProject/assets/96507825/e536737e-1818-408f-8566-66228a86cf7f)

---

## 소스분석

```
===================소스분석===========

1. board.ejs
- board는 write할 떄 페이지가 로드 되어 있어야한다. 무슨 말이냐면, write.ejs에서 클래스를 생성하고 값을 생성자를 통해서 넣을 떄, 

2. modify.ejs

3. read.ejs

4. write.ejs

순서 자체는 write를 먼저 -> board와 유기적인 관계다.

writeFrm은 <form class="write" id = "writeFrm">인 부분에서 id가 writeFrm인 태그를 가져온다.

그리고 writeFrm에 대한 이벤트처리를 진행한다.

근데 우리는 각자의 변수로썬 세션과 쿠키의 개념을 구현 할 수 없다.

즉, 배열을 생성하여 배열안에서 객체를 관리하고 생성해야된다.

객체를 어떻게 구현할래? -> 나는 VO객체를 만들어서 관리할래(배열)에 넣으면서 

const subject = e.target.subject.value;


e.target은 이벤트가 발생한 요소
e.target.subject는 폼 안에서 name이 "subject"인 요소를 가리키게된다.
subject"라는 이름의 입력 필드의 현재 값에 접근하는 것

boardsObj에 대한 설명 : localStorage에 저장되어 있는 키가 "boards"인 value값을 받아오는데 JSON.parse로 변환한다. JSON.parse는 Array로 변환해주는 역할을 진행하며 
boardsObj는 키가 "boards"인 value값을 배열의 형태로 돌려받는다 라고 해석하면 될까?

그러면 const index = boardsObj.length; 이 부분은 
boardsObj.length를 구하는데 boardsObj가 정확히 뭐야? 예를 들어 설명해줘

=============JSON.parse||JSON.stringify 설명========

JSON.stringify
- localStorage에는 기본적으로 문자열 형태로만 데이터를 저장할 수 있기 때문에, 객체를 문자열로 변환하여 저장하는 것이 필요하다. 그래서 JSON.stringify 사용하고 
-JSON.stringify()는 JavaScript 객체를 JSON 형식의 문자열로 변환

```
const person = { name: 'John', age: 30 };
const jsonString = JSON.stringify(person);

console.log(jsonString); // 출력: {"name":"John","age":30}
```
=====================================================

JSON.parse
- JSON.parse()를 사용하여 객체로 변환할 수 있다.
- 스토리지에서 받을 떄 주로 사용
- JSON.parse()는 JSON 형식의 문자열을 파싱하여 JavaScript 객체로 변환한다.

```
const jsonString = '{"name": "John", "age": 30}';
const parsedObject = JSON.parse(jsonString);

console.log(parsedObject.name); // 출력: John
console.log(parsedObject.age);  // 출력: 30
```


=======================================동작원리

const instance = new Board(index, subject, writer, content);
      
boardsObj.push(instance);

boardsObj가 아래와 같은 배열을 가지고 있다고 가정해보자.

```
[
  { id: 0, subject: "제목1", writer: "작성자1", content: "내용1" },
  { id: 1, subject: "제목2", writer: "작성자2", content: "내용2" },
]
```


새로운 게시글이 추가되면 index는 2가 되겠죠? 그러면 새로운 Board 인스턴스는 아마도 { id: 2, subject, writer, content }와 같은 형태일 것이고, 이를 boardsObj 배열에 push해서 아래와 같이 될 것이다.

```
[
  { id: 0, subject: "제목1", writer: "작성자1", content: "내용1" },
  { id: 1, subject: "제목2", writer: "작성자2", content: "내용2" },
  { id: 2, subject: "새로운제목", writer: "새로운작성자", content: "새로운내용" },
]
```
=====================write 소스 분석 끝====================

====================board 소스분석 시작===================

- board.ejs 파일을 작성해야 한다. 우리는 LocalStorage를 이용해 데이터를 저장할 예정이다.

- 데이터를 저장할 때 우리가 생성한 객체를 배열에 담을 예정이다. 그래야 관리하기 편하다.

- 배열을 생성하는 시점은 board.ejs파일이 로드되는 시점이어야 한다.

- 일반적인 게시판은 처음 들어갔을 때 보이는 화면이 게시글 목록이다.

- localstoage는 비어 있으면 null 값을 반환해주는데 이를 이용해 비어 있으면 빈 배열을 넣어준다.

처음에 let boardStr =  localstorage.getItem("boards");를 하면 null 값을 반환한다.

-> 만약에 null값이라면 , const listStr = JSON.stringify([]);
빈 배열을 선언해주고 -> setItem으로 listStr값을 localstorage에 저장한다.

-> 그리고 boardsStr = listStr =>값을 boardsStr = [] 이렇게 만든다.


template 

1. index: 이 값은 현재 게시글의 배열 인덱스를 나타낸다. 루프를 통해 게시글 배열을 순회하면서 증가하는 값이다.

2. objValue: 이 값은 배열의 각 요소, 즉 개별 게시글 객체를 나타낸다.
- 글 제목을 클릭하면 해당 게시물로 이동할 수 있도록 해보자.

- url에 이게 몇 번째 게시물인지 알 수 있도록 매개변수로 데이터의 인덱스를 넘겨주자. index = 0 -->이런식으로

- url에 매개변수를 넘겨주는 이유는 read페이지에서 몇 번째 게시물을 클릭해서 들어왔는지 알 수 없기 때문에 url 매개변수를 넘겨주는 것이다.

=========================read.ejs==========================

- 우선 상세보기를 하는데, 우선 데이터를 받아오는 작업부터 진행한다.
- boardsStr은 = localStorage.getItem으로 받아온 문자열을 boardsStr에 저장한다.
- 그 정보를 Array||배열로 boardsObj 변수에 저장한다.

const boardsStr = localStorage.getItem("boards")
console.log(boardsStr)

[{"index" : 0, "subject" : "aaa", "writer" : "bbb", "content" : "ccc" , "date" : "2022-11-20", "views" : 0},
{"index" : 1, "subject" : "aaa", "writer" : "bbb", "content" : "ccc" , "date" : "2022-11-20", "views" : 0}]


JSON.parse(boardsStr)로 하면 

JSON.parse(boardsStr)

0:{index : 0, subject : 'aaa', writer : 'bbb', content:'ccc', date : '2022-11-20'}
1:{index : 0, subject : 'aaa', writer : 'bbb', content:'ccc', date : '2022-11-20'}

로 저장된다.

쿼리스트링을 이용하여 해당 페이지에 들어가야 되기 때문에 

index = idx.split("=)[1];
const board = boardsObj[index];
//이렇게 하게되면 boardsObj[0] --> 이런식으러 boards의 객체를 가져온다.

그 객체는 board에 저장되며 이제 위치에 맞게 뿌려주면된다.

아이디는 div 요소의 id

const id = viewFrm[i].id;>여기서 id는 div요소의 id이다.viewFrm을 돌면서 id에 값을 넣는다. (subject, writer ... 이런식)

viewFrm[1].innerHTML += " " + board[id] 이런식으로 들어감


조회수 부분 
- beforeUrl = document.referrer;를 사용하여 구현한다.

- ["http:", "", "localhost:3000", "board", "board"]  pop(): 이는 배열의 마지막 요소를 추출하고 반환

===========update==========================

1. modify 페이지로 이동할 떄 매개변수로 index키와 게시글의 index번호를 넘겨준다.

2. for(let i = 0; i<modifyfrmList.length; i++)
{
const element = modifyFrmList[i].childNodes;

}

fullcalendar --> java스크립트
```




