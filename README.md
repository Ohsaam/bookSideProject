# 도서관리시스템
> **1차 개발기간 : 2023.11.4 ~ 2023.11.14




<img src="https://github.com/Ohsaam/bookSideProject/assets/96507825/0bd3b5e5-ef73-43f5-becd-7cb213411a19" width="500"/>


<a href="https://hits.seeyoufarm.com"><img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fgithub.com%2FOhsaam%2FChatJava&count_bg=%23697361&title_bg=%23555555&icon=&icon_color=%23816C6C&title=visit&edge_flat=false"/></a>

---

</div>


## 프로젝트 소개 : 
- #### 도서관리프로그램 구현 

## 화면 구성 📺

### 로그인

| 로그인  |  회원가입   | 
| :-------------------------------------------: | :-------------------------------------------: |
|  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/cbe2d074-7f3b-473c-8a31-8a81738f85eb"/> |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/91871387-69fe-43e5-9c93-bc2e3a72727c"/>
| 로그인 - (아이디/비밀번호검사)  |  회원가입- 파이어베이스연동 |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/e731bab1-bbdf-421b-8101-083c9c83b734">  |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/1d3c38a3-9755-4a8f-9d0d-201b3a1bbc2c">    |
| 로그인 - 성공  |  회원가입- 유효성검사  |  
|  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/764d5416-ff58-496d-b951-d2d18dd76401">                | <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/b83fed71-817c-4c8f-afbc-989f2877b8e6">   |
| 소셜-카카오로그인  |  소셜-구글로그인  |  
|  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/1ea8c7f3-08fb-48a1-85ec-aedd55458920">                | <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/9dbe9cbd-2704-4b49-bb84-c1b491940ed0">   |

### 검색

| 검색  |  책 내용-가격 및 할인가  |
| :-------------------------------------------: | :------------: |
|  <img width="400" src=https://github.com/Ohsaam/bookSideProject/assets/96507825/d3f969bf-2b65-407f-b34c-cdff03737ce4/> |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/fabe7a5e-ecda-4a72-bc91-e408d2144c19"/>|  
| 페이지네이션   |  포스트맨 사용   |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/8a3ea9d2-4b75-480f-b807-770bd839ad3b"/>   |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/15d3e7fa-a068-4008-9bc7-67c4df57b4f4"/>     |


### 게시판


| 게시판-list  |  게시판-글쓰기  |
| :-------------------------------------------: | :------------: |
|  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/01ad6754-6144-4fb7-bd10-77b4337bed25"/> |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/0dfdd9c1-474b-4d1e-a324-4588d9520b98"/>|  
| 게시판 - 글쓰기(완료)  |  게시판 - 글쓰기(취소)   |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/01689e7e-54a8-4026-9c47-58d7d1fcd709"/>   |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/3e0405ff-027e-4081-a5fe-d1d22fbadd3c"/>     |
| 게시판 - 상세보기  |  게시판 - 수정   |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/66e0f4ec-a128-4357-b882-3c36010060c5"/>   |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/2d6b716b-47b6-4224-ac0f-b2c4c7bbd433"/>     |
| 게시판 - 수정 후 반영 |  게시판 - 수정 후 목록   |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/bc67b188-3195-4a32-b201-de99e3c6f44f"/>   |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/8f55ad36-bc58-423e-ae60-9b0f9057e811"/>     |
| 게시판 - 삭제 |  게시판 - 삭제 후 목록   |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/ceab51fe-f10e-46da-80e9-891285b99b15"/>   |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/bd50bdee-2e5b-40b0-b3ef-4c0a18a132df"/>     |
| 게시판 - 조회수[list목록-상세조회]+ 새로고침 방어 |  게시판 - 조회수[list목록-상세조회]  + 새로고침 방어 |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/5305c1b1-cfce-4c67-83ae-165e4a44847f"/>   |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/cfd5af0c-f488-49fd-93e2-e6e32ace1968"/>     |
| 게시판 - 조회수[url접근-list목록]+ 새로고침 방어 |  게시판 - 조회수[url접근-list목록] + 새로고침 방어 |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/3c0e014b-8ff4-464a-8ecc-b3f0080207f0"/>   |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/5373a16e-1155-47ab-85c5-41ebe100d118"/>     |
| 게시판 - 페이징처리1 |  게시판 - 페이징처리2   |  
| <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/c72e7216-f691-44a9-8479-e2d3b9156cde"/>   |  <img width="400" src="https://github.com/Ohsaam/bookSideProject/assets/96507825/57326c3a-02b9-4369-a1a9-2daa6c12a169"/>     |


## 주요 기능 



### ⭐️ 로그인
- 회원가입, 로그인,로그아웃 2개의 기능 구현
- 로그인 시 로컬스토리지 및 구글파이어베이스(인증)에 저장 되어 있는 ID/Paswword 가져와서 정보가 맞으면 로그인 성공, 틀리면 로그인 실패
- RESTful API을 이용하여 카카오 및 구글 소셜로그인 구현, nickname(카카오), email(구글) 가져와서 로컬스토리지에 저장 -> (게시판 작성 시 필요)

### ⭐️ 회원가입
- 모든 필드을 충족 후 회원가입 가능 구현(유효성 검사)
- 회원가입 시 ID/Password/Nickname 로컬스토리지 및 구글파이어베이스(인증)에 저장.

### ⭐️ 책검색
- RESTful API 카카오(도서)를 이용하고, Postman을 통해서 {Key : Value} 값 매핑 
- 책이름을 입력하고/Enter 누르면 사용자에게 가격, 할인가격, 책 상태(판매,절판) 제공
- 할인가(빨간색), 책 상태(초록색)으로 제공
- 페이지 당 책 내용 20개씩 제공

### ⭐️ 게시판

- 글쓰기(Create),읽기(Read),수정(Update),삭제(Delete) CRUD 구현
- 로컬스토리지를 이용하여 상태 값 관리 (세션 및 쿠키 이용 X)
- index 쿼리스트링으로 페이지 값 부여 및 객체 관리
- 게시판 게시글 3개로 제한 및 페이지네이션 구현

## 시작 가이드

### Requirements

- NodeJS
- npm install express-generator -g 
### Installation
``` bash
$ git clone https://github.com/Ohsaam/ChatJava.git
$ cd bookSideProject
```



## Stacks 🐈

### Environment

- <img src="https://img.shields.io/badge/Eclipse-2C2255?style=for-the-badge&logo=Eclipse&logoColor=white">  
- <img src="https://img.shields.io/badge/Toad-FFA900?style=for-the-badge&logo=Toad&logoColor=white">  
- ![Visual Studio Code](https://img.shields.io/badge/Visual%20Studio%20Code-007ACC?style=for-the-badge&logo=Visual%20Studio%20Code&logoColor=white)
- ![Git](https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=Git&logoColor=white)
- ![Github](https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=GitHub&logoColor=white)             


### Development
- <img src="https://img.shields.io/badge/Oracle-F80000?style=for-the-badge&logo=Oracle&logoColor=white">
- <img src="https://img.shields.io/badge/Java-782A90?style=for-the-badge&logo=java&logoColor=white">


## 아키텍쳐
``` 
📦com
 ┣ 📂database
 ┃ ┣ 📂zipcodeview
 ┃ ┃ ┗ 📜DBConnectionMgr.java
 ┃ ┣ 📜DBConnection.java
 ┃ ┣ 📜MemberDao.java
 ┃ ┗ 📜MemberDTO.java
 ┣ 📂soket
 ┃ ┣ 📂client
 ┃ ┃ ┣ 📜SocketClient.java
 ┃ ┃ ┗ 📜SocketClientThread.java
 ┃ ┗ 📂server
 ┃ ┃ ┣ 📜Protocol.java
 ┃ ┃ ┣ 📜SocketServer.java
 ┃ ┃ ┗ 📜SocketServerThread.java
 ┗ 📂ui
 ┃ ┣ 📜LoginForm.java
 ┃ ┣ 📜MemberListFrame.java
 ┃ ┣ 📜MemberShipView.java
 ┃ ┣ 📜Sample.java
 ┃ ┗ 📜ZipCodeView.java
```
---

# 이슈관리 & 회고

## 로그인 관련 이슈
![image](https://github.com/Ohsaam/ChatJava/assets/96507825/521165b4-ce33-46bc-9927-54c9922a8946)

- 설계 방향) 아이디/패스워드/대화명/성명 + 입력 후 등록 누르면 -> 해당 디비에 저장하여 로그인 버튼 눌렀을 때 그 값을 꺼내와서 "로그인이 성공되었습니다." 라고 설계했다.


- 회원가입 창에서 MemberShipView을 이용하여 값을 받아옴 -> 처음엔 무작정 클래스 생성자 안 this를 통해서 값을 getText() 하려고 했는데, 처음 설계 방향 자체를 잘못 잡았다. -> 그래서 테이블 스키마 자체를 다시 설계하여 디비와 연동했다. 그리고 해당 쿼리문을 다시 짜서 -> select 문으로 nickname을 찾고 -> setString 자체를 username/password로 진행했다. (findNickName 메소드 구현) 해서 회원가입 창에서 값을 읽어들이는 부분을 해결했다.  ( findNickName 메소드는 소켓통신에 key값으로 닉네임을 넘기는 디비 메소드)
    




## 회원가입 이슈 

### 패스워드 입력시 : 값들이 입력되는데 캡슐화로 ( *** ) 바꾼다.
- 처음엔 변수를 2개를 써서 -> 스트링으로 읽은 다음 -> replace해서 변환하려고 했다.(**) 하지만 이 부분은 이렇게 하는 것 보단 구글링을 통해 JPasswordField 이용하여 구현완료

### 아이디  / 패스워드 / 닉네임 디비연동



![image](https://github.com/Ohsaam/ChatJava/assets/96507825/3f9750aa-40a3-4690-ab0a-df5b91c740b8)



```java
java.sql.SQLSyntaxErrorException: ORA-00942: 테이블 또는 뷰가 존재하지 않습니다
```
- 수정 했더니 해당 에러가 발생했고, 그렇다면 테이블 또는 뷰를 생성해서 연동시켜야했다. 처음엔 오라클 연동을 한 번 해봐서 자신은 없었지만 구선생을 통해 쿼리문을 짰다.


- 처음엔 단순히 인스턴스화를 통한 전역변수 이용을 하여 구현 하려고 했다. 처음엔 DB를 설계를 하지 않았는데, 아이디,패스워드, 회원정보를 저장 해야 된다는 필요성을 느껴 toad에서 테이블 등록(member) 후 아이디와 패스워드, 닉네임(회원가입창)에서 받아와서 Dao 클래스에 (Save) 메소드에서 해당 내용을 저장하는 디비를 완성했다.
(Save 메소드는 로그인을 하기 위한 회원내용 저장)


## 소켓통신 이슈

### 소켓통신 연동 이슈 
- 지금까지 연동하여 로그인을 했을 때 채팅창이 열리는 채팅프로그램을 구현 하고 싶었다.(요구사항)
  
- 하지만 지금까지 설계한 부분으로는 클래스 설계를 다시 해야 되는 상황이다. 우선 필자가 생각한 설계 방향은 우선 아이디와 비밀번호를 입력하면, 디비에 넘기는데 여기서 추가로 해야 될 부분은 닉네임을 추출하여 소켓과 연동시키는 설계방향으로 진행했다. 

- 이렇게 구현을 먼저하고 설계를 다시 하니 일을 두 번 하는 번거로움이 발생했다. 이 부분만 줄였어도 더 많은 기능을 구현 했을텐데 안타깝다. 다시 한 번 설계의 중요성을 느꼈고, 앞으론 Class Diagram을 이용해 설계를 먼저 해야겠다.
  
- 
### 소켓통신 구현 이슈
- 우선 싱글스레드가 아닌, 멀티스레드로 구현 했기 떄문에 회원 탈퇴 기능을 추가 했을 때, 2개의 채팅창이 있을 때, 한쪽에서 탈퇴하면 바로 Update 하는 메소드를 설계했다.

- 처음엔 Client/ClientThread만 수정하고 -> dtm.getValutAt() / dtm.setValueAt 이벤트 처리 메소드 설계 및 디비에서 삭제하는 메소드 설계 -> 이런 논리로 회원탈퇴를 눌렀을 때 해당 로그인한 아이디의 내용을 디비에서 삭제하고, 해당 row을 줄이는그리고 로그인 시 해당 회원정보는 삭제 되었기 때문에 다시 접속해야 되는 방향으로 설계했다. 하지만 시점의 문제가 발생했다.
  
- A라는 회원이 먼저 로그인하고 B라는 회원이 로그인 했을 때, 먼저 들어온 A를 회원 탈퇴하면 그 내용을 B에 반영하지 못했다. 해당 문제를 겪게 되면서 클래스 시점에 대한 고찰을 다시 한 번 하게 된 것 같다. 클라이언트가 소켓을 서버에 전송하게 되면 (oos)서버에서 그 내용을 읽고(ois)  다시 전송하게 되는데 이 전송과정에 대한 구현이 빠져서 이슈가 발생한 것이였다.

- 이 부분을 해결하기 위해서 필자는 LogoutRequest,removeList,sendUserList 3개의 메소드를 구현했다.

 ```java 
 LogoutRequest

	public void LogoutRequest(String nickName) {
	    try {
	        String message = nickName + "님이 퇴장하였습니다.";
	        broadCasting(210 + "#" + nickName + "#" + message);
	        // 사용자 목록 업데이트
	        removeList(nickName);
	    } catch (Exception e) {
	        e.printStackTrace();
	    }
	}

// 사용자 목록에서 사용자 제거
	public void removeList(String nickName) {
	    for (SocketServerThread sst : ss.globalList) {
	        if (sst != null && sst.chatName.equals(nickName)) {
	            ss.globalList.remove(sst);
	            break;
	        }
	    }
	}

	
	// 사용자 목록을 클라이언트에게 전송
	//서버에 접속할 때 또는 사용자 목록을 요청할 때 사용
	public void sendUserList(SocketServerThread cthread) throws IOException {
	    StringBuilder userListMessage = new StringBuilder("100#"); // 목록 메시지를 만들기 위한 문자열 빌더
	    for (SocketServerThread sst : ss.globalList) {
	        userListMessage.append(sst.chatName).append("#");
	    }
	    /**
	     * 루프 내에서, 각 클라이언트 스레드 sst의 chatName을 가져와서 userListMessage에 # 문자와 함께 추가한다.
	     */
	    cthread.send(userListMessage.toString());
	    System.out.println("회원탈퇴");
	}
```

- 이 부분을 구현하면서 가장 어려웠던 부분은 globallist를 이용해야 된다는 건 인지하고 있었지만, 조건을 어떤식으로 걸어야 될지 한참 고민 한 것 같다. 해당 메소드를 구현하면서 이슈는 해결했고, 이를 기점으로 1차 프로젝트는 마무리했다.



### 포트연결 및 닉네임 연동 오류

![image](https://github.com/Ohsaam/ChatJava/assets/96507825/050fc5d7-9683-4575-9f45-2ecade1163ec)
![image](https://github.com/Ohsaam/ChatJava/assets/96507825/9e5783e9-5e9b-4515-b5e4-a3f858e0cca0)


- 소켓 연동은 성공 했으나 닉네임을 받지 못하는 해당 오류가 발생했다.

 ```java
java.util.NoSuchElementException
	at java.base/java.util.StringTokenizer.nextToken(StringTokenizer.java:347)
 ```
- server/ serverThead /clientThread 모두 닉네임을 연동 시켜야 된다고 판단했고 그 문제가 되는 클래스 내부 메소드 로그를 찍어서 문제 되는 부분을 확인했다. -> 
  
- 이 부분에서 처음 생각한 방향은 디비를 사용하지 않고 인스턴스화, 클래스(this)를 통한 방향으로 진행을 설계하여 세션의 개념처럼 nickname을 싱글톤으로 구현했다. 하지만 이 부분에서 필자가 간과한 부분이 있다. 소켓통신 프로그램은 멀티스레드인데 싱글톤으로 따로 만들었다니. 해당 부분을 진행하면서 스레드에 대한 공부를 다시 하게 됐다. [블로그 참고](https://velog.io/@qlwb7187/%EC%9E%90%EB%B0%94-%EC%8A%A4%EB%A0%88%EB%93%9C%EA%B3%B5%EB%B6%80)
  
## troubleshooting
- 해당 오류 관련된 부분은 [필자 블로그](https://velog.io/@qlwb7187/series/Java-%EC%98%A4%EB%A5%98)란에서 진행하고 있다. 
   
